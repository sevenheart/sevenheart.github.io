---
type: 经典算法题目
title: bitmap
date: 2020-02-20
category: bitmap
---

bitMap可以极大的提高性能的算法。jdk的实现是bitSet。谷歌的实现是EWAHCompressedBitmap

应用：多条件匹配、布隆算法、倒排索引

### BitMap算法

场景：一张用户信息表中存有许多字段，要根据这些字段去匹配一个或者多个用户，这时候如果用sql语句去查询**速度慢、开销大、sql语句长**

###### 步骤：

1. 采用bitMap算法（位图算法）：将每个字段和对应用户的id做做映射，类似于搜索引擎的倒排索引，先分词然后做倒排索引。
2. 对每个字段做完id和字段的对应信息后在内存中取连续的空间每个空间是一位（bit），然后让用户id对应位数，如果对应id的位数有这个信息就把这位变成1。
3. 这样就算完成一个字段的对应的bitMap。然后将其他的字段也都分别做好相应的bitMap。
##### 求拥有某两个公共字段的用户
通过两个相关的bitMap做&运算就可以得出这个用户的Id
##### 求拥有某个字段或另一个字段的用户
通过相关的bitMap做|运算即可。
##### 不能做非运算，非运算要在一个所有用户的全量下在做非运算
##### 异或运算相同为0相异为1
比如一个所有用户的bitMap与一个有某个字段的bitMap异或运算后结果是不拥有该字段的用户id代替了非操作。

### 去重方案

#### 方案一：hashset

占用空间大不合适。hash冲突靠扩容解决

#### 方案二：

多次hash达到解决hash冲突的问题。

#### 方案三：布隆算法

多次 hash后将每次hash后的值都放在一个bitmap上对应的值变为1，这样下一个数据只有多个hash后检查对应bitmap的位置都是1才算重复降低了hash冲突。

如果每一个hash函数都对应一个bitMap能降低误判可是空间就变大了。